{% extends "base.html" %}

{% block title %}Pomodoro - Best Personal{% endblock %}

{% block extra_css %}
<style>
    .pomodoro-container {
        text-align: center;
        padding: 3rem 0;
    }
</style>
{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-6">
        <div class="card">
            <div class="card-body pomodoro-container">
                <h2>Таймер Pomodoro</h2>
                <div class="pomodoro-timer" id="timer">25:00</div>
                <div class="mb-3">
                    <button class="btn btn-primary btn-lg" id="startBtn" onclick="startTimer()">Старт</button>
                    <button class="btn btn-secondary btn-lg" id="pauseBtn" onclick="pauseTimer()" style="display: none;">Пауза</button>
                    <button class="btn btn-danger btn-lg" onclick="resetTimer()">Сброс</button>
                </div>
                <div class="btn-group" role="group">
                    <button class="btn btn-outline-primary" onclick="setTime(25)">25 мин</button>
                    <button class="btn btn-outline-primary" onclick="setTime(15)">15 мин</button>
                    <button class="btn btn-outline-primary" onclick="setTime(5)">5 мин</button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    let timeLeft = 25 * 60; // 25 минут в секундах
    let timerInterval = null;
    let isRunning = false;
    let sessionType = 'pomodoro';
    
    function updateDisplay() {
        const minutes = Math.floor(timeLeft / 60);
        const seconds = timeLeft % 60;
        document.getElementById('timer').textContent = 
            `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    }
    
    function startTimer() {
        if (!isRunning) {
            isRunning = true;
            document.getElementById('startBtn').style.display = 'none';
            document.getElementById('pauseBtn').style.display = 'inline-block';
            
            timerInterval = setInterval(() => {
                timeLeft--;
                updateDisplay();
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    alert('Время вышло!');
                    saveSession();
                    resetTimer();
                }
            }, 1000);
        }
    }
    
    function pauseTimer() {
        if (isRunning) {
            isRunning = false;
            clearInterval(timerInterval);
            document.getElementById('startBtn').style.display = 'inline-block';
            document.getElementById('pauseBtn').style.display = 'none';
        }
    }
    
    function resetTimer() {
        pauseTimer();
        timeLeft = 25 * 60;
        updateDisplay();
    }
    
    function setTime(minutes) {
        pauseTimer();
        timeLeft = minutes * 60;
        updateDisplay();
    }
    
    function saveSession() {
        const duration = (25 * 60 - timeLeft) / 60; // в минутах
        fetch('/study/pomodoro/save', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                duration: duration,
                type: sessionType
            })
        });
    }
    
    updateDisplay();
</script>
{% endblock %}

